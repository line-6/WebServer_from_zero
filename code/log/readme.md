# log 模块整体架构
异步模式：
```
┌──────────────┐         ┌──────────────┐         ┌──────────────┐
│  业务线程     │  push   │  BlockDeque  │  pop    │  写日志线程   │  write     │  日志文件
│ (生产者)      │ ──────> │  (中间队列)    │ ──────> │ (消费者)      │ ──────>  │
└──────────────┘         └──────────────┘         └──────────────┘
```
同步模式：
直接写文件，无中间队列、无写线程

## 采用异步日志架构的优势：
核心在于 Log::write() 方法中，业务线程格式化好日志内容后，异步模式将内容推到中间队列便任务完成。将内容从中间队列写到文件的任务由后台写线程 writeThread_ 完成。  
与同步模式业务线程直接 fputs() 写文件相比，异步模式显然降低了业务线程的磁盘IO等待时间（不直接fputs写文件），整体吞吐更高。这在日志量庞大的场景中优势更明显。  
## 异步日志架构的潜在问题：
异步模式下，业务线程要写的日志内容以内存形式存在中间队列中，由写线程写到磁盘，若进程崩溃则可能发生队列中内容未完全落盘的风险。 